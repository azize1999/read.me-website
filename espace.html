<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mon espace personnel | READ.ME</title>
    <link rel="stylesheet" href="style.css"> <!-- √Ä garder si tu veux styliser, sinon ignore -->
</head>
<body>
<header>   
    <nav>
        <a href="#" class="logo">READ.ME</a>
        <ul id="menu">
            <li><a href="index.html">Accueil</a></li>
        </ul> 
    </nav>
</header>

<section>
    <h2>Bienvenue <span id="username"></span> dans votre espace personnel</h2>
    <div class="notification">
        üéâ Vous pouvez partager vos conseils, publications et m√©dias‚ÄØ!
        Commencez √† mon√©tiser votre espace √† partir de 14,99‚ÄØ‚Ç¨ en ouvrant l‚Äôacc√®s √† vos clients.
    </div>
    
    <form id="post-form" class="fb-form">
         <div class="post-settings">
            <label>Visibilit√© :
                <select id="visibility">
                    <option value="public">Public</option>
                    <option value="private">Priv√©</option>
                </select>
            </label>
            <label class="commentaires">
                <input type="checkbox" id="enable-comments" checked>
                <p class="Activer">Activer les commentaires</p>
            </label>
            </div>
        <div class="fb-post-area">
            <textarea id="post-content" placeholder="Exprimez-vous..." required></textarea>
            <div class="fb-toolbar">
                <button type="button" id="add-photo" title="Ajouter photo/vid√©o">
                    <span style="font-size:1.4em;">üì∑</span>
                </button>
                <input type="file" id="media-input" accept="image/*,video/*" multiple style="display:none;">
                <button type="button" class="editor-btn" data-action="bold" title="Gras"><b>B</b></button>
                <button type="button" class="editor-btn" data-action="italic" title="Italique"><i>I</i></button>
                <button type="button" class="editor-btn" data-action="underline" title="Soulign√©"><u>U</u></button>
                <div class="emoji-section" style="display:inline-block; position:relative;">
                    <button id="add-emoji" class="emoji-btn" type="button" title="Ajouter un emoji">üòä</button>
                    <div id="emoji-picker" class="emoji-picker"></div>
                     <button type="button" id="get-location">Ajouter ma position üìç</button>
            <span id="user-location" style="margin-left:8px;"></span>
                </div>
            </div>
        </div>
        
        <div id="media-preview"></div>

       
           

        <button type="submit" class="fb-publish">Publier</button>
    </form>
    <div id="publications"></div>
</section>

<footer>
    <p>&copy; 2025 READ.ME ‚Äì Espace personnel utilisateur.</p>
</footer>

<script>
// Affiche le nom utilisateur
document.getElementById('username').textContent = localStorage.getItem('currentUser') || "";

// Bouton photo : d√©clenche input file
document.getElementById('add-photo').onclick = () => document.getElementById('media-input').click();

// Aper√ßu images/vid√©os
document.getElementById('media-input').addEventListener('change', function() {
    const preview = document.getElementById('media-preview');
    preview.innerHTML = "";
    for(const file of this.files) {
        let el;
        if(file.type.startsWith("image")) {
            el = document.createElement('img');
        } else if(file.type.startsWith("video")) {
            el = document.createElement('video');
            el.controls = true;
        }
        if(el){
            el.src = URL.createObjectURL(file);
            preview.appendChild(el);
        }
    }
});

// ----- NOUVEAU CODE EMOJIS -----
// Liste d'emojis pour le picker
const emojis = ["üòÉ","üòÇ","üòç","ü•≥","üò¢","ü•∞","üò≠","üòÖ","üò°","üëç","üôè","üëè","üí°","üéâ","üî•","‚ù§Ô∏è"];
const emojiPicker = document.getElementById('emoji-picker');
const addEmojiBtn = document.getElementById('add-emoji');
const textarea = document.getElementById('post-content');

// Injection unique des emojis dans le picker
function injectEmojis(picker, textareaTarget) {
    if (!picker.innerHTML) {
        emojis.forEach(emoji => {
            let span = document.createElement('span');
            span.textContent = emoji;
            span.onclick = function() {
                textareaTarget.value += emoji;
                picker.style.display = "none";
                textareaTarget.focus();
            };
            picker.appendChild(span);
        });
    }
}

// Affiche ou masque le picker
addEmojiBtn.onclick = function(e) {
    e.stopPropagation();
    if (emojiPicker.style.display === "block") {
        emojiPicker.style.display = "none";
    } else {
        injectEmojis(emojiPicker, textarea);
        emojiPicker.style.display = "block";
    }
};

// Ferme le picker si clic √† l'ext√©rieur
document.addEventListener('click', function(e){
    if(!emojiPicker.contains(e.target) && e.target !== addEmojiBtn) {
        emojiPicker.style.display = "none";
    }
});
// ----- FIN NOUVEAU CODE EMOJIS -----

// -------- Mini √©diteur : Gras, Italique, Soulign√© ---------
document.querySelectorAll('.editor-btn').forEach(btn => {
    btn.onclick = function() {
        const action = btn.getAttribute('data-action');
        const textarea = document.getElementById('post-content');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selected = textarea.value.substring(start, end);

        let before = textarea.value.substring(0, start);
        let after = textarea.value.substring(end);

        let formatted = selected;
        if(action === "bold") formatted = `**${selected}**`;
        if(action === "italic") formatted = `*${selected}*`;
        if(action === "underline") formatted = `<u>${selected}</u>`;

        textarea.value = before + formatted + after;
        textarea.focus();
        textarea.selectionStart = textarea.selectionEnd = start + formatted.length;
    }
});
// ----------------------------------------------------------

// ----------- Localisation utilisateur ----------------------
let userPosition = "";
document.getElementById('get-location').onclick = function() {
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(function(pos){
            userPosition = `Lat: ${pos.coords.latitude.toFixed(4)}, Lng: ${pos.coords.longitude.toFixed(4)}`;
            document.getElementById('user-location').textContent = userPosition;
        }, function(){
            userPosition = "Localisation refus√©e ou indisponible";
            document.getElementById('user-location').textContent = userPosition;
        });
    } else {
        userPosition = "Non support√©";
        document.getElementById('user-location').textContent = userPosition;
    }
};
// ----------------------------------------------------------

// ----------- Publication enrichie (avec tous les param√®tres) -------------
document.getElementById('post-form').onsubmit = function(e) {
    e.preventDefault();
    let post = document.getElementById('post-content').value;
    let mediaInput = document.getElementById('media-input');
    let div = document.createElement('div');
    div.className = "post";
    
    // Convertir le markdown simple en HTML
    post = post.replace(/\*\*([^*]+)\*\*/g, "<b>$1</b>");
    post = post.replace(/\*([^*]+)\*/g, "<i>$1</i>");
    post = post.replace(/<u>(.+?)<\/u>/g, "<u>$1</u>");
    div.innerHTML = post;
    
    // Ajout m√©dias
    if(mediaInput.files.length > 0) {
        for(let file of mediaInput.files){
            let el;
            if(file.type.startsWith("image")){
                el = document.createElement('img');
            } else if(file.type.startsWith("video")){
                el = document.createElement('video');
                el.controls = true;
            }
            if(el){
                el.src = URL.createObjectURL(file);
                div.appendChild(el);
            }
        }
    }
    // Ajout localisation
    if(userPosition) {
        let loc = document.createElement('div');
        loc.className = "post-location";
        loc.innerHTML = `üìç ${userPosition}`;
        div.appendChild(loc);
    }
    // Ajout param√®tres de publication
    let visibility = document.getElementById('visibility').value;
    let enableComments = document.getElementById('enable-comments').checked;
    let info = document.createElement('div');
    info.className = "post-meta";
    info.innerHTML = `Visibilit√©: <b>${visibility}</b> | Commentaires: <b>${enableComments ? "activ√©s" : "d√©sactiv√©s"}</b>`;
    div.appendChild(info);

    document.getElementById('publications').prepend(div);
    this.reset();
    document.getElementById('media-preview').innerHTML = "";
    document.getElementById('user-location').textContent = "";
    userPosition = "";
};
// -------------------------------------------------------------------

</script>
</body>
</html>
